<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>StyleAI — Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      :root{
        --bg-1:#f7f8fc;
        --bg-2:#eef2ff;
        --card:#ffffff;
        --muted:#6b7280;
        --accent:#6b21a8;
        --accent-2:#7c3aed;
        --success:#10b981;
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial;
        background:linear-gradient(180deg,var(--bg-1),var(--bg-2));
        display:flex;
        align-items:center;
        justify-content:center;
        padding:32px;
        color:#0f172a;
      }
      .container{
        width:100%;
        max-width:920px;
        background:var(--card);
        border-radius:14px;
        box-shadow:0 8px 30px rgba(2,6,23,0.12);
        padding:28px;
        display:grid;
        grid-template-columns:1fr 360px;
        gap:20px;
        align-items:start;
      }
      header{grid-column:1/-1; margin-bottom:6px}
      h1{margin:0;font-size:20px}
      p.lead{margin:6px 0 18px;color:var(--muted);font-size:14px}

      form{display:flex;flex-direction:column;gap:12px}
      .field{display:flex;flex-direction:column;gap:8px}
      label.small{font-size:13px;color:var(--muted)}

      input[type=file]{
        padding:10px 12px;
        border-radius:8px;
        border:1px dashed #e6e9f2;
        background:linear-gradient(180deg, #fff, #fbfbfe);
      }

      select, button{
        padding:10px 12px;border-radius:10px;border:1px solid #ecebf7;background:white;font-weight:600
      }

      button{
        cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;border:0;box-shadow:0 6px 18px rgba(124,58,237,0.18)
      }

      .result-card{
        background:linear-gradient(180deg,#fbfbff,#ffffff);
        border-radius:12px;padding:16px;border:1px solid #f1f3fb;min-height:160px;overflow:auto
      }

      .preview{display:flex;align-items:center;justify-content:center;background:#f8fafc;border-radius:10px;padding:12px;border:1px solid #eef2ff;min-height:200px}
      .preview img{max-width:100%;max-height:320px;border-radius:8px;object-fit:contain}

      pre#result{white-space:pre-wrap;background:#0b1220;color:#e6eef8;padding:12px;border-radius:8px;font-size:13px;overflow:auto}

      @media (max-width:880px){
        .container{grid-template-columns:1fr;}
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>StyleAI — Quick Demo</h1>
        <p class="lead">Upload a photo and get a mock styling analysis. This demo uses a placeholder Groq client when not configured.</p>
      </header>

      <main>
        <form id="analyzeForm">
          <div class="field">
            <label class="small">Photo</label>
            <input id="imageInput" type="file" name="image" accept="image/*" required>
          </div>

          <div class="field">
            <label class="small">Gender</label>
            <select name="gender">
              <option value="unspecified">Unspecified</option>
              <option value="female">Female</option>
              <option value="male">Male</option>
            </select>
          </div>

          <div style="display:flex;gap:10px;margin-top:8px">
            <button id="submitBtn" type="submit">Analyze</button>
            <button id="clearBtn" type="button" style="background:#f3f4f6;color:#0f172a;border:1px solid #e6e9f2">Clear</button>
          </div>
        </form>

        <section style="margin-top:14px">
          <div class="field">
            <label class="small">Analysis Output</label>
            <div class="result-card"><pre id="result">No analysis yet.</pre></div>
          </div>
        </section>
      </main>

      <aside>
        <div class="field">
          <label class="small">Preview</label>
          <div class="preview" id="preview">No image selected</div>
        </div>
        <div style="height:12px"></div>
        <div class="field">
          <label class="small">Health</label>
          <div class="result-card" style="display:flex;align-items:center;justify-content:center">Server: <span id="health" style="margin-left:8px;color:var(--success)">unknown</span></div>
        </div>
      </aside>
    </div>

    <script>
      const form = document.getElementById('analyzeForm');
      const result = document.getElementById('result');
      const preview = document.getElementById('preview');
      const imageInput = document.getElementById('imageInput');
      const clearBtn = document.getElementById('clearBtn');
      const healthEl = document.getElementById('health');

      async function checkHealth(){
        try{
          const r = await fetch('http://localhost:5000/health');
          const j = await r.json();
          healthEl.textContent = j.status === 'ok' ? 'ok' : 'unhealthy';
        }catch(e){
          healthEl.textContent = 'offline';
        }
      }
      checkHealth();

      imageInput.addEventListener('change', ()=>{
        const file = imageInput.files && imageInput.files[0];
        if(!file){ preview.innerText = 'No image selected'; return }
        const url = URL.createObjectURL(file);
        preview.innerHTML = '';
        const img = document.createElement('img');
        img.src = url;
        img.onload = () => URL.revokeObjectURL(url);
        preview.appendChild(img);
      });

      clearBtn.addEventListener('click', ()=>{
        form.reset(); preview.innerText = 'No image selected'; result.textContent = 'No analysis yet.'; 
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = new FormData(form);
        result.textContent = 'Analyzing...';
        try {
          const resp = await fetch('http://localhost:5000/analyze', { method: 'POST', body: data });
          const json = await resp.json();
          result.textContent = JSON.stringify(json, null, 2);
        } catch (err) {
          result.textContent = 'Request failed: ' + err.toString();
        }
      });
    </script>
  </body>
</html>
